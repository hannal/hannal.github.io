<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on iPhones and stuff-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link rel="icon" type="image/png" href="http://blog.hannal.com/favicon.ico" />
  <link rel="alternate" type="application/rss+xml" title="Kay on the rails RSS Feed" href="http://blog.hannal.coom/feed.xml" />
  <title>
    
      Kay on the rails &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>


    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&appId=308847979152210&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Kay as known as Hannal walks on the rails
</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    <a class="sidebar-nav-item" href="/category/essay/">한날의 낙서</a>
    <a class="sidebar-nav-item" href="/category/kay-on-the-team/">팀과 함께하는 한날</a>
    <a class="sidebar-nav-item" href="/category/start-with-django-lectures/">Django 입문자용 강좌</a>
    <a class="sidebar-nav-item" href="/category/start-with-django-webframework/">Django 중급자용 강좌</a>
    <a class="sidebar-nav-item" href="/category/flaskon-startup-diary/">플라스콘 창업 일지</a>
    <a class="sidebar-nav-item" href="/category/game/">게임 생활</a>
  </nav>

  <nav class="sidebar-nav" style="margin-top: 1.2em;">
    <a class="sidebar-nav-item" href="/profile/">소개합니다</a>
    <a class="sidebar-nav-item" href="/fingers/">손 끝에 맺힌 글</a>
    <a class="sidebar-nav-item" href="/copyright/">저작권</a>

    
    <span class="sidebar-nav-item">Alpha v</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Kay on the rails</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/hello_2015/">
        2015년을 맞이하며
      </a>
    </h1>

    <span class="post-date">01 Jan 2015</span>

    <p>삶에 방향이 있다면, 위가 아래로 아래가 위로 자리를 옮기기도 하고 흐르는 방향이 바뀌기도 하고 겉과 속이 뒤집히기도 한 2014년을 보냈습니다. </p>

<p>2009년 창업한 이래 기고, 걷고, 달리고, 넘어지고, 다시 일어나며 사업을 해오다 배가 뒤집힌 사고를, 그리고 그 사고가 사건으로 변하는 모습을 지켜보며 여정을 중단하였습니다. 그때쯤 5번 디스크가 척추에서 탈출하려는 시도를 벌여 몇 달 고생하였고, 여전히 치료를 받고 있긴 하지만 그래도 건강한 몸이 참 소중하며 지난 시간을 돌이킬 여유가 생겼습니다. 그리고, 또 그때쯤 우아를 잉태하였는데, 잘 안 움직이는 저와 아내와는 달리 아주 활달하게 태동하여 한 달여 남은 출산을 기대하고 있습니다.</p>

<p>앞으로 뭘 할 지 고민하는데 자꾸 도피성, 회피성 계획만 잡길래 다 집어치우고, 한두 달 정도 쉬면서 게임도 하고, 멍 때리기도 하고, 이런 저런 장난감을 갖고 놀기도 하고, 공부도 했습니다. 큰 방향으로 가닥을 잡을 때쯤, 주변에서 많이 챙겨주시고 도와주셔서 여름부터는 조직에 합류하여 프로그래머로 일하고 있습니다. 주로 Python을 쓰며 Go도 다루고 있는데, 데이터를 다루는 일과 하드웨어를 다루는 일에 관심을 두고 공부하고 일하며 앞으로 뭘 할 지에 대해 조금 더 세세하게 가닥을 다듬어가고 있습니다.</p>

<p>그동안 도와주셔서 고맙습니다. 저는 그동안 살아온 삶과 다른 삶을 열어 새로이 여정을 나아가고 있습니다. 정말 힘들고 어려운 전환기에 도와주신 분들이 계셔서 전환할 수 있었습니다. 고맙습니다. 이 인연에 감사하며 소중히 이어가겠습니다.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/11/start_with_django_webframework_05/">
        5. url에 view 함수 연결해서 사진 출력하기
      </a>
    </h1>

    <span class="post-date">11 Nov 2014</span>

    <ul>
<li>마지막 갱신일시 : 2014년 11월 10일 4시 31분</li>
</ul>

<p>이번 편에서는 인터넷 주소에 접속하여 Photo 모델로 올린 사진 데이터를 가져와서 View 기능을 이용하여 웹 브라우저에 관련 내용을 출력해보겠습니다.</p>

<h3>1. URL에 Photo View 연결</h3>

<h4>(1) URL Resolver</h4>

<p><img src="/assets/uploads/2014/11/05-urls_and_views.png" alt=""></p>

<p>이용자가(client) 인터넷 주소(URL : Uniform resource locator, 이하 URL)로 접속하면 웹 서버는 접속한 주소에 해당하는 내용물을 보여줍니다. Django로 운용되는 서비스도 마찬가지여서, 이용자가 URL로 접근하여 뭔가를 요청하면 그 URL에 대한 정보를 <code>urls.py</code>로 대표되는 URL dispatch에서 찾아서 연결된 구현부를 실행합니다. 구현부는 데이터를(Model) 가져와 출력물을 바로(?) 출력하기도 하고 Template을 거쳐서 출력물을 만들어낸 후 출력하기도 합니다. 이렇게 URL과 구현부을 연결해주는 역할을 Django의 View 영역인 <code>views.py</code>가 합니다. 지난 <a href="http://blog.hannal.net/start_with_django_webframework_03/">3회 강좌</a>에서 설명한 MTV 개념인데, View에서 URL로 요청받은 걸 이런저런 방법으로 처리하여 결과(출력물)를 내보낸다고 보면 됩니다.</p>

<p>Django에서는 URL Resolver(<code>urlresolver</code>)라는 모듈이 URL Dispatch 역할을 하며, <code>django/core/urlresolvers.py</code>에 있습니다. 이 <code>urlresolvers</code> 모듈에 있는 <code>RegexURLResolver</code> 클래스가 요청받은 URL을 되부를 함수(callback function) 덩어리로 바꿔줍니다. 이 덩어리는 View 함수와 함수 인자로 된 tuple 자료형이며, HTTP Handler가 받아서 View 함수를 실행하고 그 결과를 응답(response)합니다. HTTP Handler는 <code>django/core/handlers/base.py</code> 모듈에 있는 <code>BaseHandler</code> 클래스를 뜻합니다. 정리하면 다음과 같이 진행됩니다.</p>

<ol>
<li><code>BaseHandler</code> 클래스가 URL로 요청(request) 받음</li>
<li><code>RegexURLResolver</code>로 URL을 보냄</li>
<li><code>RegexURLResolver</code>가 URL에 연결된 View를 찾아서 callback 함수와 인자 등을 <code>BaseHandler</code>로 반환</li>
<li><code>BaseHandler</code>에서 이 함수를 실행하여 결과값인 출력물을 받음.</li>
<li>출력</li>
</ol>

<p>중간 중간에 middleware 등과 같은 과정이 있지만 큰 흐름은 이러합니다.</p>

<p>위 내용은 몰라도 Django를 다루는 데 아무 지장 없습니다. 저는 다음 두 문장을 쓰기 위해 위 설명을 쓴 겁니다.</p>

<ol>
<li>Model이나 View에 기능을 구현</li>
<li>이용자가 서버에 있는 자원에 접근하는 경로인 URL을 URL Dispatch 처리 모듈인 <code>urls.py</code>에 등록하고 그 URL에 구현부를 연결</li>
</ol>

<p>우리는 앞으로 이런 흐름으로 기능을 구현합니다.</p>

<h4>(2) 개별 사진 보기 View - 1</h4>

<p><code>photo</code> 앱, 그러니까 <code>photo</code> 디렉터리 안에 있는 views.py 파일을 엽니다. 별 내용은 없습니다. 세상에 인사하는 View부터 구현해보겠습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;3번...3번 사진을 보여 드릴게요.&#39;</span><span class="p">)</span>
</code></pre></div>
<p>이번엔 <code>urls.py</code> 파일이 있는 <code>pystagram</code> 디렉터리에서 <code>urls.py</code> 파일을 열어서 <code>url(r&#39;^photo/$&#39;, &#39;photo.views.single_photo&#39;, name=&#39;view_single_photo&#39;),</code> 이 줄을 추가합니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;view_single_photo&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</code></pre></div>
<p>끝났습니다. 웹브라우저에서 <code>http://127.0.0.1:8000/photo/</code>로 접속하면 <code>HttpResponse</code>로 넘긴 문장이 출력되는 걸 보실 겁니다.</p>

<p><img src="/assets/uploads/2014/11/05-hello_world_by_views.png" alt=""></p>

<h4>(3) urls.py</h4>

<p><code>urls.py</code>에는 Django의 <code>urls</code> 모듈에 있는 <code>url</code> 함수를 이용하여 URL 연결자를 만들어서 <code>urlpatterns</code>에 넣습니다. <code>urlpatterns</code>는 url 함수로 만든 객체를 담은 객체이며 그냥 <code>list</code> 자료형입니다.</p>

<p><code>patterns</code> 함수는 두 종류 인자를 받습니다. 하나는 <code>prefix</code>인데, 맨 앞에 있는 아무 내용이 없는 문자형 자료(객체)인 <code>&#39;&#39;</code>가 <code>prefix</code>입니다. <code>prefix</code>는 따로 설명하겠습니다. <code>prefix</code> 뒤에 나오는 부분은 <code>url</code> 함수로 만든 URL 연결자들입니다. 그냥 쭈욱 나열한 것 뿐입니다.</p>

<p>그럼 주소 연결자를 만드는 <code>url</code> 함수 부분을 보겠습니다. 이 함수는 총 다섯 개 인자를 받습니다. </p>

<ul>
<li>regex : 주소 패턴 (정규표현식)</li>
<li>view : 연결할 View</li>
<li>prefix : 연결할 View 이름에 대한 접두사</li>
<li>name : 주소 연결자 이름</li>
<li>kwargs : <code>urls</code>에서 View로 전달할 <code>dict</code>형(사전형) 인자</li>
</ul>

<p><code>regex</code>와 <code>view</code>는 필수 인자이고, 나머지는 생략해도 됩니다. 우리가 <code>urls.py</code>에 추가한 <code>url(r&#39;^photo/$&#39;, &#39;photo.views.single_photo&#39;, name=&#39;view_single_photo&#39;),</code>를 기준으로 놓고 보면 이러합니다.</p>

<ul>
<li>regex : <code>r&#39;^photo/$&#39;</code></li>
<li>view : <code>&#39;photo.views.single_photo&#39;</code></li>
<li>name : <code>name=&#39;view_single_photo&#39;</code></li>
</ul>

<p><code>name</code> 인자는 생략해도 된다고 했으니, 한 번 생략해서 <code>urls.py</code>를 저장한 후 웹브라우저에서 <code>/photo/</code>로 접속해보세요. 아무 이상 없을 겁니다. 이 <code>name</code> 인자는 템플릿에서 URL 연결자 이름으로 주소를 출력하는 등 몇 가지 편의에 쓰이며 유용합니다.</p>

<p><code>view</code> 인자엔 실행할 함수의 이름경로를 문자열을 지정합니다. <code>photo.views.single_photo</code>란 <code>photo</code> 앱(패키지, 디렉터리) 안에 있는 <code>views</code> 모듈(<code>views.py</code>)의 <code>single_photo</code> 함수를 뜻합니다. <code>single_photo</code> 함수는 <code>views.py</code>에서 “3번...3번 사진을 보여 드릴게요”라는 문자열을 반환하는 함수지요. 앞서 “4. <code>BaseHandler</code>에서 이 함수를 실행하여 결과값인 출력물을 받음.”라고 설명한 부분이 바로 이 부분입니다. View 함수는 “3번...” 문자열을 반환하는데(<code>return</code>) 그 반환받는 주체가 바로 <code>BaseHandler</code>입니다. 물론 이 View 함수를 실행하는 주체이기도 하고요.</p>

<p><code>prefix</code>는 <code>view</code> 인자에 문자열로 지정하는 View 경로를 간결하게 줄여주는 편의 요소입니다. <code>photo</code> 앱의 <code>views</code> 모듈에 있는 여러 함수를 URL에 연결한다면 <code>urls.py</code>가 이런 모양이 될 겁니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/2$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo2&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/3$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo3&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/4$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo4&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/5$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo5&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/6$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo6&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/7$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo7&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/8$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo8&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>어우, 기계가 할 일을 사람이 하고 있는 광경이네요. <code>prefix</code>를 이용해서 View 명기되는 이름경로를 줄여보겠습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;photo.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/2$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo2&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/3$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo3&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/4$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo4&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/5$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo5&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/6$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo6&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/7$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo7&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/8$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo8&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>매번 <code>photo.views</code>를 <code>prefix</code>에 명기하고 이후에 붙는 URL 연결자의 View 지정 부분에선 생략했습니다. Django 내부에서도 이 <code>prefix</code>는 되게 단순하게 처리합니다. (<code>django/conf/urls/__init__.py</code> 참조)</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">view</span>
</code></pre></div>
<p>즉, <code>prefix</code>가(가령, <code>&#39;photo.view&#39;</code>) 있으면 <code>view</code> 이름(가령, <code>&#39;single_photo&#39;</code>) 앞에 덧붙이는 거지요. 그냥 덧붙이면 <code>&#39;photo.viewsingle_photo&#39;</code>처럼 돼버리니 접두사와 이름 사이에 <code>.</code>을 추가한 것이고요.</p>

<p>그런데 <code>url</code> 함수의 인자로 들어가는 <code>prefix</code> 인자인데 <code>patterns</code> 함수의 <code>prefix</code> 인자에 접두사를 넣었네요? 실제로 우리에게 의미있게 쓰이는 <code>prefix</code>는 <code>patterns</code> 함수의 <code>prefix</code>입니다. <code>patterns</code> 함수로 <code>prefix</code>를 지정하면, 이후에 지정된 URL 연결자인 <code>url</code> 함수로 <code>prefix</code>를 넘겨줍니다. 다시말해, <code>url</code> 함수의 <code>prefix</code>는 우리가 직접 쓰기 보다는 Django가 쓰는 데 필요한 겁니다.</p>

<p>주의할 점은 <code>patterns</code> 함수의 <code>prefix</code>는 이 함수가 실행되면서 넘겨받는 URL연결자들 모두에 적용이 된다는 점입니다. 예를 들어, <code>single_photo5</code>부터 <code>single_photo8</code>은 <code>image</code> 앱의 <code>views</code>에 있는 함수라고 가정하지요. 이럴 경우 <code>prefix</code>를 다시 지정해야 합니다. 어떻게 해야 할까요? 힌트는 <code>patterns</code> 함수의 결과값을 담는 <code>urlpatterns</code>가 그냥 <code>list</code> 자료형이라는 점입니다. 힌트가 아니라 답이군요.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;photo.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/2$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo2&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/3$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo3&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/4$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo4&#39;</span><span class="p">),</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;image.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/5$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo5&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/6$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo6&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/7$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo7&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/8$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo8&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>다른 <code>prefix</code>를 지정한 <code>patterns</code> 함수를 실행하고, 그 결과값을 <code>urlpatterns</code>에 덧이으면 됩니다. <code>urlpatterns</code>가 <code>list</code> 자료형이니 <code>urlpatterns.extend( ... )</code> 이렇게 추가해도 됩니다.</p>

<p>기왕 기계가 할 일을 사람이 하지 않고 기계가 하도록 한 김에 좀 더 간결히 줄여보겠습니다. </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;photo.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/(?P&lt;photo_id&gt;\d+)$&#39;</span><span class="p">,</span> <span class="s">&#39;single_photo&#39;</span><span class="p">)</span>
<span class="p">),</span>
</code></pre></div>
<p><code>/photo/</code> URL 뒤에 붙는 숫자를 정규표현식으로 패턴화하여 지정한 겁니다. <code>\d+</code> 부분이 바로 숫자(Decimal)가 하나 이상 있다는 걸 뜻하며, URL이 이 패턴에 해당되면 <code>single_photo</code> 함수로 연결됩니다. Pystagram 기획 내용에 따르면 개별 사진을 보는 URL은 <code>/photo/&lt;사진 ID&gt;/</code>이니 <code>urls.py</code>도 위 내용으로 정하겠습니다. 아참, <code>name</code> 인자까지 덧붙이겠습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/(?P&lt;photo_id&gt;\d+)$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;view_single_photo&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</code></pre></div>
<p>이 정도로 Django의 URL Dispatch 기능의 작동법과 사용법 설명을 마치고, 추가 기능은 필요하면 그때 그때 설명하겠습니다. 아참, <code>url</code> 함수가 받는 마지막 인자인 <code>kwargs</code>는 부록에서 설명하겠습니다. </p>

<h4>(4) 개별 사진 보기 View - 2</h4>

<p>웹브라우저에서 <code>/photo/&lt;사진 ID&gt;/</code>, 예를 들어 <code>/photo/3</code>으로 접근하면 “TypeError at /photo/3”이라는 오류가 뜹니다. 내용은 
“single<em>photo() got an unexpected keyword argument &#39;photo</em>id&#39;”이고요. <code>single_photo</code> 함수로 <code>photo_id</code>라는 인자를 넘길려는데 <code>single_photo</code> 함수가 받지 않아서 그렇습니다. <code>photo_id</code>는 <code>urls.py</code>에서 <code>(?P&lt;photo_id&gt;\d+)</code> 바로 이 부분입니다. 정규표현식 패턴에 해당되는 문자열이 <code>?P&lt;이름&gt;</code>에 지정된 <code>이름</code>에 저장되어 View 함수의 인자로 넘겨집니다. <code>/photo/숫자</code> URL에서 숫자가 <code>photo_id</code>라는 이름을 갖는 인자에 저장되어 <code>single_photo</code> 함수로 전달됩니다. 그래서 <code>single_photo</code> 함수가 이 인자를 받도록 해야 합니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">photo_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;{0}번...{0}번 사진을 보여 드릴게요.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">photo_id</span><span class="p">))</span>
</code></pre></div>
<p>첫 번째로 받는 인자인 <code>request</code>는 View 함수가 받는 기본 인자입니다. 요청(request)과 관련된 여러 정보와 기능을 수행합니다. 많은 일을 수행하는 객체이니 앞으로 그때 그때 설명하겠습니다.</p>

<p><code>urls.py</code>에서 View 함수로 넘길 인자 이름을 지정하지 않아도 별 문제는 없습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">url(r&#39;^photo/(\d+)$&#39;, &#39;photo.views.single_photo&#39;, name=&#39;view_single_photo&#39;),
</code></pre></div>
<p><code>urls.py</code>에서 위와 같이 <code>?P&lt;photo_id&gt;</code>을 빼서 인자 이름을 없애면, 인자는 이름없이 배열 형태로 View 함수로 넘겨집니다. 인자를 받는 View 함수에서는 <code>*args</code> 인자로 받으면 됩니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;{0}번...{0}번 사진을 보여 드릴게요.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<p>인자가 여러 개라면 넘겨받은 순서대로 <code>args</code>에 인자들이 <code>args[0]</code>, <code>args[1]</code>, <code>args[2]</code>, ... 이런 식으로 담깁니다. 하지만 코드를 알아보기 안 좋으니 어지간히 변수 이름 짓는 게 고통스러운 게 아니라면 인자 이름을 지정하길 권합니다.</p>

<p>자, 넘겨받은 <code>photo_id</code> 인자를 Python의 문자형 객체의 포맷 메서드를 이용해 출력하고 있으니, 웹브라우저에서 <code>/photo/</code> 뒤에 여러가지 <strong>숫자</strong>를 넣어서 접근해보세요.</p>

<p><img src="/assets/uploads/2014/11/05-view_with_photo_id.png" alt=""></p>

<p>숫자없이 <code>/photo/</code>로 또는 숫자가 아닌 문자가 포함된 주소(가령 <code>/photo/3-1023</code>이나 <code>/photo/3번/</code>)로도 접근해보세요. “Page not found (404)” 오류가 출력됩니다. <code>urls.py</code>에 지정한 URL 패턴에 해당되는 게 없으면 <code>404</code> 오류가 발생합니다. <code>urlresolver</code>에서 일으키지요.</p>

<h3>2. Photo 모델에서 사진 정보를 가져와 출력하기</h3>

<h4>(1) Photo 모델로 객체 찾기(lookup)</h4>

<p>코드부터 보겠습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Photo</span>

<span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">photo_id</span><span class="p">):</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">Photo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">photo_id</span><span class="p">)</span>

    <span class="n">response_text</span> <span class="o">=</span> <span class="s">&#39;&lt;p&gt;{photo_id}번...{photo_id}번 사진을 보여 드릴게요.&lt;/p&gt;&#39;</span>
    <span class="n">response_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;p&gt;{photo_url}&lt;/p&gt;&#39;</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">response_text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">photo_id</span><span class="o">=</span><span class="n">photo_id</span><span class="p">,</span>
            <span class="n">photo_url</span><span class="o">=</span><span class="n">photo</span><span class="o">.</span><span class="n">image_file</span><span class="o">.</span><span class="n">url</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
<p>먼저 <code>from .models import Photo</code>문으로 <code>photo</code> 앱에 있는 <code>models</code> 모듈에서 <code>Photo</code> 모델을 가져옵니다. <code>.models</code>는 <code>photo.models</code>와 같은 내용인데, <code>views.py</code> 파일과 같은 디렉터리(경로)에 있기 때문입니다.</p>

<p>그 다음에 <code>Photo</code> 모델의 <code>objects</code> 객체의 <code>get</code> 메서드를 이용해 <code>photo_id</code>에 해당하는 사진 데이터(Photo 모델의 객체(instance)) 가져와서 <code>photo</code>라는 변수에 담습니다. <code>Photo</code> 모델에 있는 <code>image_file</code>이라는 필드에 접근해서 <code>url</code> 속성(property)를 이용해 지정한 사진의 URL을 출력합니다.</p>

<p>모델을 다루는 건 나중에 자세히 다루니, 이번 편에서는 모델을 이용해 데이터를 가져오는 것만 다뤘습니다.</p>

<h4>(2) 찾는 객체가 없으면 404 오류 출력</h4>

<p><code>/photo/숫자</code> URL 중 숫자를 되게 큰 값, 예를 들어 1023을 넣어보세요. “DoesNotExist at /photo/1023”라는 오류가 출력됩니다. 사진 ID 중 1023번인 자료가 없어서 모델 영역에서 발생한 오류입니다. 이 오류 대신 “사진이 없다”는 안내를 하려면 이 오류에 대한 예외(exception) 처리를 해야 합니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="k">try</span><span class="p">:</span>
        <span class="n">photo</span> <span class="o">=</span> <span class="n">Photo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">photo_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Photo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;사진이 없습니다.&quot;</span><span class="p">)</span>
</code></pre></div>
<p><code>DoesNotExist</code>라는 <code>Exception</code>이 발생하면 이를 try/except 문으로 잡아내서 예외처리를 한 겁니다. 그런데 <code>Photo</code> 모델로 사진 데이터를 가져오려는데 데이터가 없는 상황은 “없는 페이지”라고 봐도 됩니다. 그래서 이런 상황에선 <code>404</code> 오류를 일으키고 <code>404</code> 오류 안내 페이지를 따로 만들어 제공하는 게 낫습니다. 이걸 간편하게 해주는 것이 <code>get_object_or_404</code> 함수입니다. 이 함수는 <code>django.shortcuts</code> 모듈에 있습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>

<span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">photo_id</span><span class="p">):</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Photo</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">photo_id</span><span class="p">)</span>
</code></pre></div>
<p>이런 식으로 사용하면 됩니다. 첫 번째 인자로 모델을 넣고, 그 뒤로는 탐색 키워드 인자를 넣습니다. 탐색 키워드 인자란 <code>pk=photo_id</code>와 같이 모델에서 객체를 찾는 데 쓰이는 내용을 뜻합니다.</p>

<p>내용을 변경한 전체 코드를 보겠습니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Photo</span>

<span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">photo_id</span><span class="p">):</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Photo</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">photo_id</span><span class="p">)</span>

    <span class="n">response_text</span> <span class="o">=</span> <span class="s">&#39;&lt;p&gt;{photo_id}번...{photo_id}번 사진을 보여 드릴게요.&lt;/p&gt;&#39;</span>
    <span class="n">response_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;p&gt;{photo_url}&lt;/p&gt;&#39;</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">response_text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">photo_id</span><span class="o">=</span><span class="n">photo_id</span><span class="p">,</span>
            <span class="n">photo_url</span><span class="o">=</span><span class="n">photo</span><span class="o">.</span><span class="n">image_file</span><span class="o">.</span><span class="n">url</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
<p><img src="/assets/uploads/2014/11/05-view_data_from_model.png" alt=""></p>

<p><code>photo</code> 모델을 이용해 사진 데이터를 가져와 관련 정보를 웹 브라우저에 출력까지 했습니다. 관련 정보를 출력한다고 했지 사진을 출력한다고는 안 했습니다. ^^ 하지만, 이대로 끝마치기엔 서운하니 사진 출력까지만 하고 설명은 다른 편에서 다루겠습니다.</p>

<h4>(3) 업로드한 파일을 URL로 접근하기</h4>

<p>먼저 화면에 출력된 사진 파일 URL로 이미지를 출력하도록 HTML 태그를 출력할 내용에 추가하겠습니다. <code>img</code> 태그를 쓰는 것이지요.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="n">response_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;p&gt;&lt;img src=&quot;{photo_url}&quot; /&gt;&lt;/p&gt;&#39;</span>
</code></pre></div>
<p>이 줄을 기존 <code>response_text</code> 변수가 있는 줄 아래에 추가합니다. 그런 뒤 웹브라우저에서 접속해보세요. 이미지가 출력되지 않습니다. 화면에 출력된 이미지 파일 URL을 서버 호스트 내용과 합쳐서, 그러니까 <code>http://localhost:8000/static_files/...</code> 이렇게 만들어서 웹브라우저로 접근해보세요.</p>

<p><img src="/assets/uploads/2014/11/05-404_without_media_url.png" alt=""></p>

<p><code>404</code> 오류가 발생합니다.</p>

<p>Django는 이용자가 업로드한 파일은 <code>MEDIA_URL</code>과 <code>MEDIA_ROOT</code>라는 설정값을 참조하여 제공(serve)합니다. 모델의 <code>FileField</code> 필드 클래스나 <code>ImageField</code> 필드 클래스로 지정하는 <code>upload_to</code> 인자는 <code>MEDIA_URL</code>과 <code>MEDIA_ROOT</code> 경로 아래에 위치합니다. 이 두 설정값을 무시하는 것도 가능하지만 운영하는 데 번거롭고 보안에도 좋진 않습니다.</p>

<p>자, 그럼 <code>MEDIA_URL</code>과 <code>MEDIA_ROOT</code>를 설정하겠습니다. <code>pystagram</code> 패키지(디렉터리) 안에 있는 <code>settings.py</code> 파일을 열고 맨 아래에 다음 두 줄을 추가합니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;static_files&#39;</span><span class="p">)</span>
</code></pre></div>
<p>업로드된 파일은 <code>static_files</code> 라는 URL을 따르므로 <code>urls.py</code>에도 이와 관련된 내용을 등록해야 합니다. 원리는 이렇습니다. <code>static_files</code> 뒤에 나오는 경로를 받은 뒤 지정된 경로에 있는 이미지 파일을 읽어온 후 웹브라우저에 보내는 겁니다. 경로에 없으면 <code>404</code> 오류를 일으키고요. 아, 생각만 해도 귀찮습니다. 다행히 Django엔 이런 걸 처리해주는 기능이 이미 있습니다. <code>django.conf.urls.static</code> 모듈에 있는 <code>static</code> 함수지요. <code>urls.py</code> 맨 아래에 다음 줄을 추가해보세요.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="s">&#39;static_files&#39;</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</code></pre></div>
<p>자, 끝났습니다. 이제 다시 웹브라우저에서 개별 사진 URL로 접근해보세요.</p>

<p><img src="/assets/uploads/2014/11/05-view_photo_successfully.png" alt=""></p>

<p>실은 업로드한 파일의 URL에 들어가는 <code>static_files</code>은 모델에서 지정하지 않고 <code>settings.py</code>에서 지정해야 합니다. 강좌 진행을 위해 <code>photo</code> 모델의 <code>image_file</code>과 <code>filtered_image_file</code> 필드에 <code>static_files</code> 경로를 넣은 것이지요. 나중에 이와 관련된 내용을 자세히 다루면서 손보도록 하겠습니다. :)</p>

<h3>3. 부록</h3>

<h4>(1) url 함수의 kwargs 역할</h4>

<p><code>url</code> 함수에 사용되는 인자인 <code>kwargs</code>는 View 함수로 임의 인자를 건내는 데 사용됩니다. View 함수는 URL 패턴에서 지정된 값을 인자로 건내받는데, URL에는 어떤 상태나 정보를 나타내지 않으면서 상황에 따라 View 함수에 넘기는 값을 따로 지정하려면 <code>kwargs</code> 인자를 활용해야 합니다. 예를 들어, 개별 사진을 <code>/photo/&lt;숫자ID&gt;/</code>이나 <code>/hidden_photo/&lt;숫자ID&gt;/</code> URL로 접근할 수 있고, 두 URL 모두 <code>single_photo</code> 함수가 대응한다고 가정하겠습니다. 어떤 URL로 접근했는지 <code>single_photo</code> 함수에서 알려면 접근한 URL을 분석해도 되지만, URL엔 보이지 않는 정보를 <code>single_photo</code> 함수에 인자로 보내면 좀 더 편할 겁니다. 이 인자를 <code>hidden</code>이라고 하겠습니다. 먼저 <code>urls.py</code>에 <code>kwargs</code> 인자를 정의합니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^photo/(?P&lt;photo_id&gt;\d+)$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;view_single_photo&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hidden_photo/(?P&lt;photo_id&gt;\d+)$&#39;</span><span class="p">,</span> <span class="s">&#39;photo.views.single_photo&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;view_hidden_single_photo&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;hidden&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}),</span>
</code></pre></div>
<p>이번엔 <code>single_photo</code> View 함수가 <code>hidden</code> 인자를 받을 차례입니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">single_photo</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">photo_id</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hidden</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c"># todo: 뭔가 은밀한 작업을 합시다</span>
        <span class="k">pass</span>
</code></pre></div>
<p><code>single_photo</code> 함수는 따로 <code>hidden</code> 인자를 넘기지 않으면 <code>False</code> 값으로 <code>hidden</code> 인자를 받습니다. 즉, <code>/photo/&lt;숫자ID&gt;/</code>로 접근하는 경우입니다. 하지만, <code>/hidden_photo/&lt;숫자ID&gt;/</code>로 접근하면 <code>hidden</code> 인자는 <code>True</code>로 <code>single_photo</code> 함수에 넘겨집니다. <code>/hidden_photo/&lt;숫자ID&gt;/</code> URL을 아는 사람만 <code>hidden</code>이 <code>True</code>인 상황을 만끽하게 되겠지요.</p>

<h4>(2) render와 HttpResponse</h4>

<p><code>views.py</code>를 처음 열면 맨 위에 <code>from django.shortcuts import render</code>라는 부분이 있습니다. 그런데 우리는 이 <code>render</code> 함수를 한 번도 쓰지 않고, <code>HttpResponse</code>를 따로 불러들여서 이를 이용해 화면에 뭔가를 출력했습니다. 이 둘의 차이는 뭘까요?</p>

<p><code>HttpResponse</code>는 Django의 View가 HTTP handler로 보내는 출력물의 가장 기본 형태인 객체를 만드는 클래스입니다. HTTP handler가 건내받는 출력물의 가장 기본형이지요. 그래서 <code>HttpResponse</code> 자체는 템플릿을 같은 걸 처리하는 기능을 담고 있지 않습니다. 그래서 템플릿을 따로 처리하여 그려낸(rendered) 출력물을 문자열 그 자체(plain text)로 받아서 출력해야 합니다. 이런 처리에 필요한 코드는 꽤 반복되므로 반복되는 부분을 별도 함수로 만들어서 편하게 템플릿으로 그려낸 출력물을 <code>HttpResponse</code>로 보내는 함수가 바로 <code>render</code>입니다. <code>render</code> 함수를 보면 반환하는 최종 값도 결국은 <code>HttpResponse</code> 클래스로 만든 객체입니다.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">render_to_string</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="o">**</span><span class="n">httpresponse_kwargs</span><span class="p">)</span>
</code></pre></div>
<h4>(3) 소스 파일에 한글을 입력하니 오류가 떠요!</h4>

<p>혹시 <code>views.py</code> 파일 맨 위에 <code># coding: utf-8</code> 내용을 넣지 않은 채 <code>views.py</code> 파일 안에 한글을 직접 입력했다면 <code>SyntaxError</code> 오류가 발생합니다. 오류 내용은 <code>Non-ASCII character &#39;무엇&#39; in file</code>인데, 파일에 ascii 문자가 아닌 문자가 있다는 뜻입니다. Python 버전 2대를 쓰는 입문자라면 영원히(?) 고통 받는 상황입니다.</p>

<p>이 문제는 Python 모듈(파일)에 ascii 문자의 표현 범위를 벗어나는 한글이나 한자 같은 문자가 포함되면 Python 인터프리터가 “어?! 이 문자 뭐임? 몰라, 무서워. 뱉어”라며 Syntax 예외를 일으켜서 발생합니다. 이 문제를 예방하려면 소스 파일에 ascii 문자만 입력하거나 <a href="http://legacy.python.org/dev/peps/pep-0263/">소스 파일이 어떤 문자형(charset)으로 작성됐는지 Python 인터프리터에게 알려줘야 합니다</a>. 그 알려주는 방법이 소스 파일 상단에 <code># coding: utf-8</code>를 명기한 것이지요. Emacs 같은 편집기를 위해 <code># -*- coding: utf-8 -*-</code> 라고 명기하기도 합니다. </p>

<p>Python 2의 기본 문자형(charset)이 ascii이기 때문에 Python 2를 쓰는 이상 유니코드와 관련된 고통은 감수해야 합니다. :) 아, 이런 문제는 Python 3에선 발생하지 않습니다.</p>

<hr>

<p>이것으로 강좌 5편을 마칩니다. 이번에도 늦어서 죄송합니다.</p>

<ul>
<li><a href="https://github.com/hannal/start_with_django_webframework/tree/05-fullsource/pystagram">5편까지 진행한 전체 소스 코드</a></li>
</ul>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33535239-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
